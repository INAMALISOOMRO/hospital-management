<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - User Management</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', Arial, sans-serif;
      background-color: #f5f6fa;
      color: #2d3436;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-left img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: white;
      padding: 8px;
      object-fit: contain;
    }

    .header-info h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .header-info p {
      font-size: 14px;
      opacity: 0.9;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-info {
      text-align: right;
    }

    .user-info .role-badge {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      font-size: 12px;
      margin-top: 5px;
    }

    .logout-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid white;
      color: white;
      padding: 10px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: white;
      color: #667eea;
    }

    .container {
      max-width: 1400px;
      margin: 40px auto;
      padding: 0 40px;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .card {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .card-icon {
      font-size: 40px;
      margin-bottom: 15px;
    }

    .card h3 {
      font-size: 16px;
      color: #636e72;
      margin-bottom: 10px;
    }

    .card .number {
      font-size: 36px;
      font-weight: 700;
      color: #2d3436;
    }

    .section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .section-header h2 {
      font-size: 24px;
      color: #2d3436;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-danger {
      background: #ff6b6b;
      color: white;
    }

    .btn-danger:hover {
      background: #ff5252;
    }

    .btn-warning {
      background: #ffa502;
      color: white;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 8px;
      font-weight: 600;
      color: #2d3436;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    table th,
    table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }

    table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #2d3436;
      font-size: 14px;
    }

    table tr:hover {
      background: #f8f9fa;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-active {
      background: #d4edda;
      color: #155724;
    }

    .status-inactive {
      background: #f8d7da;
      color: #721c24;
    }

    .role-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .role-admin {
      background: #ffe0e0;
      color: #c30000;
    }

    .role-reception {
      background: #d4f1f4;
      color: #006a75;
    }

    .role-medical {
      background: #d4e9ff;
      color: #0056b3;
    }

    .action-btns {
      display: flex;
      gap: 8px;
    }

    .action-btns button {
      padding: 6px 12px;
      font-size: 12px;
    }

    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 0 20px;
      }

      header {
        padding: 15px 20px;
        flex-direction: column;
        gap: 15px;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }
    }


/* autoupdater button */
.update-section {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    margin-bottom: 30px;
  }
  
  .update-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
  }
  
  .update-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
  }
  
  .update-status {
    margin-top: 15px;
    padding: 12px;
    border-radius: 8px;
    display: none;
    font-size: 14px;
    font-weight: 600;
  }
  
  .update-status.checking {
    display: block;
    background: #e3f2fd;
    color: #1976d2;
    border-left: 4px solid #1976d2;
  }
  
  .update-status.available {
    display: block;
    background: #fff3e0;
    color: #f57c00;
    border-left: 4px solid #f57c00;
  }
  
  .update-status.downloading {
    display: block;
    background: #e1f5fe;
    color: #0277bd;
    border-left: 4px solid #0277bd;
  }
  
  .update-status.ready {
    display: block;
    background: #e8f5e9;
    color: #2e7d32;
    border-left: 4px solid #2e7d32;
  }
  
  .update-status.uptodate {
    display: block;
    background: #e8f5e9;
    color: #2e7d32;
    border-left: 4px solid #2e7d32;
  }
  
  .update-status.error {
    display: block;
    background: #ffebee;
    color: #c62828;
    border-left: 4px solid #c62828;
  }
  
  .version-info {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
  }
  
  .version-info p {
    margin: 5px 0;
    font-size: 14px;
  }



    
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <img src="logo.png" alt="Hospital Logo" onerror="this.style.display='none'">
      <div class="header-info">
        <h1>Admin Dashboard</h1>
        <p>User Management System</p>
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <div id="currentUserName">Administrator</div>
        <span class="role-badge">ADMIN</span>
      </div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </header>

<!-- autoupdater  -->
<div class="update-section">
  <div class="section-header">
    <h2>Software Updates</h2>
  </div>
  
  <p style="color: #666; margin-bottom: 20px;">
    Keep your hospital management system up to date with the latest features and security improvements.
  </p>
  
  <button class="update-button" onclick="manualUpdateCheck()">
    üîÑ Check for Updates
  </button>
  
  <div id="updateStatus" class="update-status"></div>
  
  <div class="version-info">
    <p><strong>Current Version:</strong> <span id="currentVersion">Loading...</span></p>
    <p><strong>Last Checked:</strong> <span id="lastChecked">Never</span></p>
    <p><strong>Auto-Update:</strong> <span style="color: #2e7d32;">‚úÖ Enabled</span></p>
  </div>
</div>



  <div class="container">
    <!-- Statistics Cards -->
    <div class="dashboard-cards">
      <div class="card">
        <div class="card-icon">üë•</div>
        <h3>Total Users</h3>
        <div class="number" id="totalUsers">0</div>
      </div>
      <div class="card">
        <div class="card-icon">‚úÖ</div>
        <h3>Active Users</h3>
        <div class="number" id="activeUsers">0</div>
      </div>
      <div class="card">
        <div class="card-icon">üè•</div>
        <h3>Reception Staff</h3>
        <div class="number" id="receptionCount">0</div>
      </div>
      <div class="card">
        <div class="card-icon">üíä</div>
        <h3>Medical Staff</h3>
        <div class="number" id="medicalCount">0</div>
      </div>
    </div>

    <!-- Create New User -->
    <div class="section">
      <div class="section-header">
        <h2>Create New User</h2>
      </div>

      <div class="alert alert-success" id="successAlert"></div>
      <div class="alert alert-error" id="errorAlert"></div>

      <form id="createUserForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="fullName">Full Name *</label>
            <input type="text" id="fullName" placeholder="Enter full name" required>
          </div>
          <div class="form-group">
            <label for="username">Username *</label>
            <input type="text" id="username" placeholder="Enter username" required>
          </div>
          <div class="form-group">
            <label for="password">Password *</label>
            <input type="password" id="password" placeholder="Enter password" required>
          </div>
          <div class="form-group">
            <label for="role">Role *</label>
            <select id="role" required>
              <option value="">-- Select Role --</option>
              <option value="admin">Admin (Full Access)</option>
              <option value="reception">Reception (Patient Management)</option>
              <option value="medical">Medical Store (Pharmacy)</option>
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Create User</button>
      </form>
    </div>

    <!-- User List -->
    <div class="section">
      <div class="section-header">
        <h2>All Users</h2>
        <button class="btn btn-primary" onclick="loadUsers()">üîÑ Refresh</button>
      </div>

      <table id="usersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Full Name</th>
            <th>Username</th>
            <th>Role</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <tr>
            <td colspan="7" style="text-align: center; padding: 40px;">Loading users...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let authDB;
    let currentUser = null;

    // Open database
    function openAuthDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open('HospitalAuthDB', 1);
        
        request.onupgradeneeded = function(event) {
          const db = event.target.result;
          if (!db.objectStoreNames.contains('users')) {
            const userStore = db.createObjectStore('users', { keyPath: 'id', autoIncrement: true });
            userStore.createIndex('username', 'username', { unique: true });
          }
          if (!db.objectStoreNames.contains('sessions')) {
            db.createObjectStore('sessions', { keyPath: 'sessionId' });
          }
        };
        
        request.onsuccess = function(event) {
          authDB = event.target.result;
          resolve(authDB);
        };
        
        request.onerror = function(event) {
          reject(event.target.error);
        };
      });
    }

// At the top of checkAuthentication() in patients.html, medicine.html, admin.html
// async function checkAuthentication() {
//   // Check if we're being redirected from a logout
//   const urlParams = new URLSearchParams(window.location.search);
//   if (urlParams.get('logout') === 'true') {
//     localStorage.clear();
//     window.location.replace('index.html?forceLogin=true');
//     return;
//   }
  
//   const session = localStorage.getItem('currentSession');
  
//   if (!session) {
//     alert('Please login first');
//     window.location.href = 'index.html?forceLogin=true';
//     return;
//   }
  
//   // ... rest of your existing code
// }

//  AUTOUPDATER 
const { app } = require('electron').remote || require('@electron/remote');
  const { ipcRenderer } = require('electron');
  
  // Display current version
  document.getElementById('currentVersion').textContent = app.getVersion();
  
  // Function to show status message
  function showStatus(message, type) {
    const statusDiv = document.getElementById('updateStatus');
    statusDiv.className = 'update-status ' + type;
    statusDiv.textContent = message;
    
    // Update last checked time
    if (type === 'checking') {
      document.getElementById('lastChecked').textContent = new Date().toLocaleString();
    }
  }
  
  // Manual update check
  async function manualUpdateCheck() {
    showStatus('üîç Checking for updates...', 'checking');
    
    try {
      const result = await ipcRenderer.invoke('check-for-updates');
      
      if (result.success) {
        // Wait for update events
        setTimeout(() => {
          // If no update found after 5 seconds, show up-to-date
          if (document.getElementById('updateStatus').classList.contains('checking')) {
            showStatus('‚úÖ You are running the latest version!', 'uptodate');
          }
        }, 5000);
      } else {
        showStatus('‚ùå Update check failed: ' + result.error, 'error');
      }
    } catch (error) {
      showStatus('‚ùå Error checking for updates: ' + error.message, 'error');
    }
  }
  
  // Listen for update events from main process
  ipcRenderer.on('update-checking', () => {
    showStatus('üîç Checking for updates...', 'checking');
  });
  
  ipcRenderer.on('update-available', (event, info) => {
    showStatus(`üéâ New version ${info.version} is available! Downloading...`, 'available');
  });
  
  ipcRenderer.on('update-not-available', () => {
    showStatus('‚úÖ You are running the latest version!', 'uptodate');
  });
  
  ipcRenderer.on('download-progress', (event, progress) => {
    const percent = Math.round(progress.percent);
    const downloaded = (progress.transferred / 1024 / 1024).toFixed(2);
    const total = (progress.total / 1024 / 1024).toFixed(2);
    showStatus(`üì• Downloading update: ${percent}% (${downloaded}MB / ${total}MB)`, 'downloading');
  });
  
  ipcRenderer.on('update-downloaded', (event, info) => {
    showStatus('‚úÖ Update downloaded! Application will restart to install...', 'ready');
  });
  
  ipcRenderer.on('update-error', (event, error) => {
    showStatus('‚ùå Update error: ' + error, 'error');
  });
  
  // Auto-hide success messages after 10 seconds
  setInterval(() => {
    const statusDiv = document.getElementById('updateStatus');
    if (statusDiv.classList.contains('uptodate')) {
      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 10000);
    }
  }, 1000);





    // Check authentication
    function checkAuthentication() {
  const session = localStorage.getItem('currentSession');
  
  if (!session) {
    alert('Please login first');
    window.location.href = 'index.html?forceLogin=true';
    return null;
  }

  try {
    const currentUser = JSON.parse(session);
    
    // For patients.html use 'reception', for medicine.html use 'medical', for admin.html use 'admin'
    const requiredRole = 'reception'; // CHANGE THIS based on the page
    
    if (currentUser.role !== requiredRole && currentUser.role !== 'admin') {
      alert('Access denied. You do not have permission to access this page.');
      localStorage.clear();
      window.location.href = 'index.html?forceLogin=true';
      return null;
    }

    console.log('Logged in as:', currentUser.fullName, '(' + currentUser.role + ')');
    return currentUser;
  } catch (error) {
    console.error('Session error:', error);
    localStorage.clear();
    window.location.href = 'index.html?forceLogin=true';
    return null;
  }
}

// Call this at the start
checkAuthentication();
    // Show alert
    function showAlert(type, message) {
      const alertId = type === 'success' ? 'successAlert' : 'errorAlert';
      const alertDiv = document.getElementById(alertId);
      alertDiv.textContent = message;
      alertDiv.style.display = 'block';
      
      setTimeout(() => {
        alertDiv.style.display = 'none';
      }, 5000);
    }

    // Load statistics
    async function loadStatistics() {
      try {
        const db = await openAuthDB();
        const transaction = db.transaction(['users'], 'readonly');
        const store = transaction.objectStore('users');
        const request = store.getAll();

        request.onsuccess = function() {
          const users = request.result || [];
          
          document.getElementById('totalUsers').textContent = users.length;
          document.getElementById('activeUsers').textContent = users.filter(u => u.status === 'active').length;
          document.getElementById('receptionCount').textContent = users.filter(u => u.role === 'reception').length;
          document.getElementById('medicalCount').textContent = users.filter(u => u.role === 'medical').length;
        };

        request.onerror = function() {
          console.error('Error loading statistics');
        };
      } catch (error) {
        console.error('Statistics error:', error);
      }
    }

    // Load users
    async function loadUsers() {
      try {
        const db = await openAuthDB();
        const transaction = db.transaction(['users'], 'readonly');
        const store = transaction.objectStore('users');
        const request = store.getAll();

        request.onsuccess = function() {
          const users = request.result || [];
          const tbody = document.getElementById('usersTableBody');
          
          if (users.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">No users found</td></tr>';
            return;
          }

          tbody.innerHTML = users.map(user => `
            <tr>
              <td>${user.id}</td>
              <td>${user.fullName}</td>
              <td>${user.username}</td>
              <td><span class="role-badge role-${user.role}">${user.role.toUpperCase()}</span></td>
              <td><span class="status-badge status-${user.status}">${user.status.toUpperCase()}</span></td>
              <td>${new Date(user.createdAt).toLocaleDateString()}</td>
              <td>
                <div class="action-btns">
                  ${user.status === 'active' 
                    ? `<button class="btn btn-warning" onclick="toggleUserStatus(${user.id}, 'inactive')">Deactivate</button>`
                    : `<button class="btn btn-primary" onclick="toggleUserStatus(${user.id}, 'active')">Activate</button>`
                  }
                  ${user.username !== 'admin' 
                    ? `<button class="btn btn-danger" onclick="deleteUser(${user.id})">Delete</button>`
                    : ''
                  }
                </div>
              </td>
            </tr>
          `).join('');
        };

        request.onerror = function() {
          console.error('Error loading users');
          const tbody = document.getElementById('usersTableBody');
          tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: red;">Error loading users</td></tr>';
        };
      } catch (error) {
        console.error('Load users error:', error);
      }
    }

    // Create user
    async function createUser(event) {
      event.preventDefault();

      const fullName = document.getElementById('fullName').value.trim();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const role = document.getElementById('role').value;

      if (!fullName || !username || !password || !role) {
        showAlert('error', 'Please fill in all fields');
        return;
      }

      if (password.length < 4) {
        showAlert('error', 'Password must be at least 4 characters');
        return;
      }

      try {
        const db = await openAuthDB();
        const transaction = db.transaction(['users'], 'readwrite');
        const store = transaction.objectStore('users');
        const index = store.index('username');
        
        // Check if username exists
        const checkRequest = index.get(username);
        
        checkRequest.onsuccess = function() {
          if (checkRequest.result) {
            showAlert('error', 'Username already exists');
            return;
          }

          // Create new user
          const newUser = {
            username,
            password,
            fullName,
            role,
            status: 'active',
            createdAt: new Date().toISOString(),
            createdBy: currentUser ? currentUser.userId : null
          };

          const addRequest = store.add(newUser);
          
          addRequest.onsuccess = function() {
            showAlert('success', `User "${fullName}" created successfully!`);
            document.getElementById('createUserForm').reset();
            loadUsers();
            loadStatistics();
          };

          addRequest.onerror = function(e) {
            console.error('Add user error:', e);
            showAlert('error', 'Failed to create user. Please try again.');
          };
        };

        checkRequest.onerror = function(e) {
          console.error('Check username error:', e);
          showAlert('error', 'Error checking username. Please try again.');
        };

      } catch (error) {
        console.error('Create user error:', error);
        showAlert('error', 'An error occurred: ' + error.message);
      }
    }

    // Toggle user status
    async function toggleUserStatus(userId, newStatus) {
      if (!confirm(`Are you sure you want to ${newStatus === 'active' ? 'activate' : 'deactivate'} this user?`)) {
        return;
      }

      try {
        const db = await openAuthDB();
        const transaction = db.transaction(['users'], 'readwrite');
        const store = transaction.objectStore('users');
        
        const getRequest = store.get(userId);
        
        getRequest.onsuccess = function() {
          const user = getRequest.result;
          if (!user) {
            showAlert('error', 'User not found');
            return;
          }
          
          user.status = newStatus;
          
          const updateRequest = store.put(user);
          
          updateRequest.onsuccess = function() {
            showAlert('success', `User ${newStatus === 'active' ? 'activated' : 'deactivated'} successfully`);
            loadUsers();
            loadStatistics();
          };

          updateRequest.onerror = function() {
            showAlert('error', 'Failed to update user status');
          };
        };

        getRequest.onerror = function() {
          showAlert('error', 'Error retrieving user');
        };
      } catch (error) {
        console.error('Toggle status error:', error);
        showAlert('error', 'An error occurred');
      }
    }

    // Delete user
    async function deleteUser(userId) {
      if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
        return;
      }

      try {
        const db = await openAuthDB();
        const transaction = db.transaction(['users'], 'readwrite');
        const store = transaction.objectStore('users');
        
        const deleteRequest = store.delete(userId);
        
        deleteRequest.onsuccess = function() {
          showAlert('success', 'User deleted successfully');
          loadUsers();
          loadStatistics();
        };

        deleteRequest.onerror = function() {
          showAlert('error', 'Failed to delete user');
        };
      } catch (error) {
        console.error('Delete user error:', error);
        showAlert('error', 'An error occurred');
      }
    }

    // Logout
   function logout() {
  if (confirm('Are you sure you want to logout?')) {
    // Clear all storage
    localStorage.clear();
    sessionStorage.clear();
    
    // Redirect to login with force parameter
    window.location.href = 'index.html?forceLogin=true';
  }
}
// function clearAllData() {
//   return new Promise((resolve) => {
//     // Clear localStorage
//     localStorage.clear();
//     sessionStorage.clear();
    
//     // Clear IndexedDB
//     const dbNames = ['HospitalAuthDB', 'HospitalDB', 'PharmacyDB'];
//     let completed = 0;
    
//     dbNames.forEach(dbName => {
//       const request = indexedDB.open(dbName);
//       request.onsuccess = function(event) {
//         const db = event.target.result;
//         const stores = Array.from(db.objectStoreNames);
        
//         if (stores.length > 0) {
//           const transaction = db.transaction(stores, 'readwrite');
//           stores.forEach(storeName => {
//             if (storeName === 'sessions') {
//               const store = transaction.objectStore(storeName);
//               store.clear();
//             }
//           });
//         }
        
//         db.close();
//         completed++;
//         if (completed === dbNames.length) resolve();
//       };
      
//       request.onerror = function() {
//         completed++;
//         if (completed === dbNames.length) resolve();
//       };
//     });
//   });
// }
    // Initialize
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        await openAuthDB();
        await checkAuth();
        await loadUsers();
        await loadStatistics();
        
        document.getElementById('createUserForm').addEventListener('submit', createUser);
      } catch (error) {
        console.error('Initialization error:', error);
        alert('Failed to initialize application: ' + error.message);
      }
    });
  </script>
</body>
</html>